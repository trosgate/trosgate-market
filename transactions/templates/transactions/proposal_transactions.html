{% extends "dashboard/main_base.html" %}
{% load static %}
{% load widget_tweaks %}
{% block content %}
{% include 'dashboard/main_sidebar.html' %}

<!--Main Start-->
	<main id="wt-main" class="wt-main wt-haslayout">

		<!--Company listing starts-->
		<div class="wt-proposalholder">
			<div class="container">
				<div class="row justify-content-md-center">
					<div class="col-12">
						<div class="wt-sectionhead wt-textcenter">
							<div class="wt-sectiontitle">
								<h3>Proposal Transactions</h3>
								<div class="alert alert-info" role="alert">
									<span style="color: green; font-weight: bold;"> All Your Transactions history</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			{% if request.user.freelancer %}
			<div class="table-responsive">
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th>#</th>
							<th>Client</th>
							<th>Purchase Date</th>
							<th>Method</th>
							<th>Proposal Sold</th>
							<th>Base Price</th>
							<th>Sales ({{base_currency}}) </th>
							{% if active_team.created_by == request.user %}
							<th>Manager</th>
							{% endif %}
						</tr>
					</thead>
					
					<tbody>
						{% for proposal in proposals %}
						<tr>
							<td>{{forloop.counter}}</td>
							<td>{{proposal.purchase.client.get_full_name|capfirst}}</td>
							<td>{{proposal.created_at}}</td>
							<td>{{proposal.purchase.payment_method}}</td>
							<td class="text-left">{{proposal.proposal.title|truncatechars:60}}</td>
							<td>{{proposal.sales_price}}</td>
							<td>{{proposal.total_sales_price}} ({{proposal.disc_sales_price}} px @ {{proposal.staff_hired}} staff)</td> 
							{% if active_team.created_by == request.user %}
							<td><a href="{% url 'resolution:proposal_resolution' proposal.id proposal.proposal.slug %}"><button type="button" class="btn btn-outline-danger btn-sm"><i class="fa fa-window-restore"></i> Manage</button></a></td>
							{% endif %}
						</tr>
						{% endfor %}
					</tbody>
				</table>
				{% if not proposals %}
				<div class="alert alert-info text-center" role="alert">
					<span style="color: blue; font-weight: bold;"> Hmmm! No proposal sold Yet. Keep hope alive</span>
				</div>
				{% endif %}
			</div>
			{% endif %}

			{% if request.user.clients %}
			<div class="table-responsive">
				<table class="table table-striped table-sm">
					<thead>
						<tr>
							<th>#</th>
							<th>Team</th>
							<th>Purchase Date</th>
							<th>Method</th>
							<th>Proposal Sold</th>
							<th>Purchase</th>
							<th>Hired</th>
							<th>Total</th>
							<th>Manager</th>
						</tr>
					</thead>
					
					<tbody>
						{% for proposal in proposals %}
						<tr>
							<td>{{forloop.counter}}</td>
							<td>{{proposal.proposal.team|capfirst}}</td>
							<td>{{proposal.created_at}}</td>
							<td>{{proposal.purchase.payment_method}}</td>
							<td class="text-left">{{proposal.proposal.title|truncatechars:100}}</td>
							<td>{{proposal.disc_sales_price}}</td>
							<td>{{proposal.staff_hired}}</td>
							<td>{{proposal.total_sales_price}}</td>     
							<td><a href="{% url 'resolution:proposal_resolution' proposal.id proposal.proposal.slug %}"><button type="button" class="btn btn-outline-danger btn-sm"><i class="fas fa-spinner fa-spin"></i> Manage</button></a></td>
						</tr>
						{% comment %} {% url 'proposals:create_proposal' %} {% endcomment %}
						{% endfor %}
					</tbody>
				</table>
					{% if not proposals %}
					<div class="alert alert-info text-center" role="alert">
						<span style="color: blue; font-weight: bold;"> Hmmm! No applications made Yet. Keep hope alive</span>
					</div>
					{% endif %}
				</div>  
				{% endif %}
		</div>
		
		<div class="wt-proposalholder mt-6">
			<div class="row justify-content-md-center">
				<div class="wt-sectionhead wt-textcenter">
					<span>Copyright @ {{website.site_name}}</span>
				</div>
			</div>
		</div>
	</main>

	{% endblock %}

