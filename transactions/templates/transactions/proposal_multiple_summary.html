{% extends "dashboard/main_base.html" %}
{% load static %}
{% block content %}

		<div class="wt-haslayout wt-innerbannerholder">
			<div class="alert alert-info" role="alert">
				<span style="color: green; font-weight: bold;">!Client Notice: <br>(1) This page lists all your Addons(if any) <br>(2) In your final checkout, we will present a total of your addons to you</span>
			</div>
		</div>				

			<div class="wt-dashboardbox">
				<div class="wt-dashboardboxcontent wt-jobdetailsholder">
					<div class="wt-freelancerholder">
						<section class="wt-haslayout wt-dbsectionspace">
							<div class="wt-freelancerholder wt-rcvproposalholder">
							{% if not hiringbox %}
								<div class="col-12">Your Box is empty <a href="{% url 'account:dashboard' %}">Go to Dashboard</a></div>
							{% endif %} 								 
						</div>										
						<div class="row">
							<div class="col-12 col-sm-12 col-md-12 col-lg-12">
							<div class="card">
								<div class="card-header">
									<h6>Hiring More Staff</h6>
								</div>
		
								<div class="row">
								<div class="col-lg-12">
		
									<div class="table-responsive">
									<table class="table table-striped table-sm">
										<thead>
										<tr>
	
											<th>#</th>
											<th>Thumbnail</th>
											<th>Proposals</th>
											<th>Availability</th>
											<th>Modify AddOns</th>
											<th>Action</th>
											<th>Salary</th>
											{% comment %} <th>Total Salary</th> {% endcomment %}
	
										</tr>
										</thead>
										
										{% for member in hiringbox %}
										{% with proposal=member.proposal %}
										<tbody data-index="{{proposal.id}}" class="proposal-item">
											<tr>
											<td>{{forloop.counter}}</td> 
											<td>{{proposal.image_tag}}</td>
											<td>{{proposal.title}}</td>
											<td><a href="javascript:void(0);" class="btn btn-outline-primary btn-sm mt-2"> {{proposal.team.members.count}} Staff{{proposal.team.members.count|pluralize}}</a></td>
											<td>
												<div class="form-group">
													<select id="select{{proposal.id}}" class="form-control" style="width:auto;">
														<option selected disabled hidden> {{member.member_qty}} </option>
														{% if proposal.team.members.count >= 1 %}<option value="1"> 1 </option>{% endif %}
														{% if proposal.team.members.count >= 2 %}<option value="2"> 2 </option>{% endif %}
														{% if proposal.team.members.count >= 3 %}<option value="3"> 3 </option>{% endif %}
														{% if proposal.team.members.count >= 4 %}<option value="4"> 4 </option>{% endif %}
														{% if proposal.team.members.count >= 5 %}<option value="5"> 5 </option>{% endif %}
													</select>                                                                                                                    
													<button type="button" id="modify-box" data-index="{{proposal.id}}" class="btn btn-outline-success btn-sm mt-2 modify-box"> + / - </button>
												</div>
											</td>
											<td><button type="button" id="remove-box" data-index="{{proposal.id}}" class="btn btn-outline-danger btn-sm mt-2 remove-box"><i class="fa fa-trash"></i></button></td>
											<td><button class="btn btn-outline-primary btn-sm mt-2" type="button"> ${{proposal.salary}}</a></button></td>
											{% comment %} <td><button class="btn btn-outline-primary btn-sm mt-2" type="button"> ${{member.total_price}}</a></button></td> {% endcomment %}
										
											</tr>
										</tbody>
										{% endwith %}
										{% endfor %}
									</table>
								</div>
								</div>
							</section>
							<div class="wt-updatall">
								<i class="fa fa-dollar-sign"></i>
								<span>Get 10% discount for every hire above $500 (Sum of Each proposal Qty * Each proposal Salary )</span>
								<a href="{% url 'transactions:payment_option_selection' %}" class="wt-btn">Checkout @ $:<div id="grandtotal" class="btn btn-inline-danger text-white">{{hiring_box.get_total_price_before_fee_and_discount}}</div></a>
							</div>	
					</div>
				</div>						
			</div>					
		</div>

		<div class="wt-proposalholder">
			<div class="row justify-content-md-center">
				<div class="wt-sectionhead wt-textcenter">
					<span>Copyright @ {{website.site_name}}</span>
				</div>
			</div>
		</div>
	
	<script>
		//Script to delete proposal in session
		$(document).on('click', '.remove-box', function (e) {
		  e.preventDefault();
		  var propid = $(this).data('index');
		  $.ajax({
			type: 'POST',
			url: '{% url "transactions:remove_from_hiring_box" %}',
			data: {
				proposalid: $(this).data('index'),
				csrfmiddlewaretoken: "{{csrf_token}}",
				action: 'post'
			},
			success: function (json) {
				$('.proposal-item[data-index="' + propid + '"]').remove();
				document.getElementById("members-qty").innerHTML = json.member_qty
				document.getElementById("grandtotal").innerHTML = json.grandtotal
			},
			error: function (xhr, errmsg, err) {}
		  });
		})
	  </script>
	  <script>
		  //Script to modify proposal in session
		$(document).on('click', '.modify-box', function (e) {
		  e.preventDefault();
		  var propid = $(this).data('index');
		  $.ajax({
			type: 'POST',
			url: '{% url "transactions:modify_from_hiring_box" %}',
			data: {
				proposalid: $(this).data('index'),
				memberqty: $('#select' + propid +' option:selected').text(),
				csrfmiddlewaretoken: "{{csrf_token}}",
				action: 'post'
			},
			success: function (json) {
				console.log(json)
				document.getElementById("members-qty").innerHTML = json.member_qty
				document.getElementById("grandtotal").innerHTML = json.grandtotal
			},
			error: function (xhr, errmsg, err) {}
		  });
		})
	  </script>
{% endblock %}
