{% extends "dashboard/main_base.html" %}
{% load static %}
{% block content%}

			<!--Main Start-->
            
            <!--Inner Home Banner Start-->
            <div class="wt-haslayout wt-innerbannerholder">
                <div class="container">
                    <div class="row justify-content-md-center">
                        <div class="col-xs-12 col-sm-12 col-md-8 push-md-2 col-lg-6 push-lg-3">
                            <div class="wt-innerbannercontent">
                                <div class="wt-title"><h2>Contract Page</h2></div>
                                <ol class="wt-breadcrumb">
                                    <li><a href="{% url 'account:dashboard' %}">Dashboard</a></li>
                                    <li><a href="{% url 'contract:external_contract_list' %}">Contract</a></li>
                                    <li class="wt-active">Detail</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!--Inner Home End-->

			<div class="wt-haslayout wt-main-section">
			<div class="container">
				<div class="row justify-content-md-center">
					<div class="col-xs-12 col-sm-12 col-md-12 col-lg-8 push-lg-2 float-center">
                        <div class="wt-dashboardbox">
                            <div class="wt-dashboardboxtitle">
                                <h2>Contract Details</h2>
                                <a href="{% url 'contract:external_contract_list' %}" class="text-primary">Return to Contracts</a>								
                            </div>
                            
                            <div class="wt-dashboardboxcontent">
                            <div class="wt-companysinfo">
                                <ul class="wt-postarticlemeta">
                                    {{website.site_logo_tag}}
                                </ul><br><br><br>
                                <h5>{{contract.line_one}}</h5>
                            </div>
                            
                            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-8 push-lg-2 float-center">
                            </div>	
                            <div class="wt-jobdescription wt-tabsinfo">
                                <div class="wt-tabscontenttitle">
                                    <h2>Contract Terms</h2>
                                </div>	
                                <div class="form-row">
                                    
                                    <div class="form-group col-md-6">
                                        <span><i class="fa fa-group"> Freelancer: {{contract.created_by.get_full_name}}</i></span><br><br>
                                        <span><i class="fa fa-group"> Team: {{contract.team.title}}</i></span><br><br>
                                        <span><i class="fa fa-arrow-up"> Contract Status: {{contract.get_reaction_display}}</i></span><br><br>
                                        <span><i class="far fa-calendar"> Duration: {{contract.get_contract_duration_display}}</i></span><br><br>
                                        <span><i class="far fa-calendar"> Reference: {{contract.reference}}</i></span><br><br>
                                        <span><i class="far fa-calendar"> Time Created: {{contract.date_created}}</i></span><br><br>
                                    </div>
                                        
                                </div>
                            <div class="wt-jobdetails wt-tabsinfo">
                                <div class="wt-tabscontenttitle">
                                    <h2>Services</h2>
                                </div> 
                                <div class="table-responsive">
                                    <table class="table table-striped table-sm">
                                    <thead>
                                        <tr>
                                            <th scope="col">#</th>
                                            <th scope="col">Line Services</th>
                                            <th scope="col">Quantity</th>
                                            <th scope="col">Price</th>
                                            <th scope="col">Total</th>
                                        </tr>
                                    </thead>
                                    
                                    <tbody>
                                        {% if contract.line_one %}
                                        <tr>
                                            <th scope="row">1</th>
                                            <td>{{ contract.line_one}}(main)</td>
                                            <td>{{ contract.line_one_quantity}}</td>
                                            <td>{{ contract.line_one_unit_price}}</td>
                                            <td>{{website.merchant.country.currency}} {{ contract.line_one_total_price }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if contract.line_two %}
                                        <tr>
                                            <th scope="row">2</th>
                                            <td>{{ contract.line_two}}</td>
                                            <td>{{ contract.line_two_quantity}}</td>
                                            <td>{{ contract.line_two_unit_price}}</td>
                                            <td>{{website.merchant.country.currency}} {{ contract.line_two_total_price }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if contract.line_three %}
                                        <tr>
                                            <th scope="row">3</th>
                                            <td>{{ contract.line_three}}</td>
                                            <td>{{ contract.line_three_quantity}}</td>
                                            <td>{{ contract.line_three_quantity}}</td>
                                            <td>{{website.merchant.country.currency}} {{ contract.line_two_total_price }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if contract.line_four %}
                                        <tr>
                                            <th scope="row">4</th>
                                            <td>{{ contract.line_four}}</td>
                                            <td>{{ contract.line_four_quantity}}</td>
                                            <td>{{ contract.line_four_unit_price}}</td>
                                            <td>{{website.merchant.country.currency}} {{ contract.line_four_total_price }}</td>
                                        </tr>
                                        {% endif %}
                                        {% if contract.line_five %}
                                        <tr>
                                            <th scope="row">5</th>
                                            <td>{{ contract.line_five}}</td>
                                            <td>{{ contract.line_five_quantity}}</td>
                                            <td>{{ contract.line_five_unit_price}}</td>
                                            <td>{{website.merchant.country.currency}} {{ contract.line_five_total_price }}</td>
                                        </tr>
                                        {% endif %}
                                        <tr>
                                            <td colspan="4"><strong>Grand Total</strong></td>
                                            <td><strong>{{website.merchant.country.currency}} {{ contract.grand_total}}</strong></td>
                                        </tr>                                                
                                    </tbody>
                                </table>
                            </div>
                                {% if contract.notes %}                                             
                                <div class="wt-jobdetails wt-tabsinfo">
                                    <div class="wt-tabscontenttitle">
                                        <h2>Description</h2>
                                    </div> 
                                <div class="form-row">
                                    <div class="form-group col-md-12">
                                        <h7>{{ contract.notes|linebreaks }}</p>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                            </div>
                            
                            {% if client %}
                            {% if request.user.email == contract.client.email %}
                            </div>
                                </div>
                                    </div>
                                    <div class="wt-updatall">
                                        <i class="ti-announcement"></i>
                                        <span>Redeem Contract with 1-Click Checkout (1CC)</span>
                                        <button class="wt-btn" data-toggle="modal" data-target="#oneClickContractCheckout">Balance Checkout</button>
                                    </div>
                                    <div class="wt-updatall">
                                        <i class="ti-announcement"></i>
                                        <span>Redeem Contract and pay direct</span>
                                        <a href="{% url 'contract:external_contract_fee_structure' contract.id contract.slug %}" class="wt-btn">Direct Pay</a>
                                    </div>
                                </div>
                            </div>
                            {% endif %}
                            {% endif %}
                        </div>  
                    </div>
                </div>
            </div>
        </div>
        {% comment %} </main> {% endcomment %}
        {% include 'client/partials/one_click_contract_modal.html' %}

{% endblock %}

{% block scripts %}

<script>
	$(document).on('click', '#oneClickCheckout', function (e) {
	  e.preventDefault();

	  let displayMessage = document.getElementById('oneClick-message');
	  let displayError = document.getElementById("oneClick-error")
	  $.ajax({
		type: 'POST',
		url: '{% url "client:externcontract_one_click_checkout" %}',
		data: {
			contractId:'{{contract.id}}',
			csrfmiddlewaretoken: "{{csrf_token}}",
			action: 'oneclick-extpay'
		},
		beforeSend:function(){
			$("#oneClickCheckout").attr("disabled", true);
		},
		success: function (json) {
			if(json.errors != ''){
				displayError.innerHTML = json.errors;
				$("#oneClickCheckout").attr("disabled", false);
				return false
			}
			else{
				displayError.innerHTML = '';
				displayMessage.innerHTML = json.message;
				$("#oneClickCheckout").attr("disabled", true);
			}
		},
		error: function (xhr, errmsg, err) {
			$("#oneClickCheckout").attr("disabled", false);
		}
	  });
	})
  </script>

  {% endblock scripts %}

